<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>词向量总结 | Max Blog</title>
<meta name="description" content="醉里挑灯看剑" />
<link rel="shortcut icon" href="https://MaXXXXfeng.github.io/favicon.ico?v=1720336264936">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://MaXXXXfeng.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



  </head>
  <body>
    <header class="site-header">
  <a href="https://MaXXXXfeng.github.io">
  <img class="avatar" src="https://MaXXXXfeng.github.io/images/avatar.png?v=1720336264936" alt="">
  </a>
  <h1 class="site-title">
    Max Blog
  </h1>
  <p class="site-description">
    醉里挑灯看剑
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</header>

    <div class="main">
      <div class="main-content">
        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              词向量总结
            </h2>
            <div class="post-info">
              <span>
                2021-05-16
              </span>
              <span>
                14 min read
              </span>
              
                <a href="https://MaXXXXfeng.github.io/tag/nlp/" class="post-tag">
                  # 自然语言处理
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516224833.jpg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>对于常见的词向量的总结</p>
<!-- more -->
<h2 id="1-word-embedding介绍">1 word embedding介绍</h2>
<p>词嵌入是NLP任务中语言模型和特征学习的统称，用来将单词或者词组映射到实数域上的向量。</p>
<p>在NLP任务的底层输入中，使用词嵌入的方式将文本向量化，可以极大提高对应的NLP任务的效果。</p>
<p>简单说，就是找一种方法，把输入的文本进行向量化的表示。从而进行后续的任务。</p>
<h2 id="2-发展历史">2 发展历史</h2>
<p>词向量的大致发展过程可以看成从统计学角度到语言模型的角度。</p>
<p>从机器学习再到深度学习。</p>
<h3 id="21-统计模型one-hot-编码">2.1 统计模型：One-Hot 编码</h3>
<p>构建字典/词表，基于字典/词表，对每一个单词进行编码。</p>
<p><strong>构建步骤：</strong></p>
<ul>
<li>建立一个|V|（V表示词汇表总长度）的全零向量</li>
<li>将每个单词在词表中中对应的index维度置为1，其他元素保持为0</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>词表维度过大(数万或者数十万级别)，导致词向量稀疏，计算量大</li>
<li>单词与单词之间是独立的，无法体现单词之间的关系。任意两个词向量的内积均为0，与单词的实际意义不符。</li>
</ul>
<h3 id="22-统计模型共现向量">2.2 统计模型：共现向量</h3>
<p>每一个词不是相互独立的，与其相邻的单词关系密切。基于<strong>共现窗口</strong>，统计窗口内词语出现的频率，构建共现矩阵。</p>
<p><strong>示例</strong></p>
<p>以三句话为例，设定窗口为1，构建共现矩阵，并将单词编码</p>
<ul>
<li>
<p>句子1：I like NLP</p>
</li>
<li>
<p>句子2：I like deep learning</p>
</li>
<li>
<p>句子3：I enjoy working</p>
</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516194924.png" alt="tup" loading="lazy"></figure>
<p><strong>缺点：</strong></p>
<ul>
<li>
<p>每个词向量维度为|V|，导致计算量较大。</p>
</li>
<li>
<p>每当登陆新词时，需要统计更新整个共现矩阵 (V*V)。</p>
</li>
<li>
<p>仅考虑了词与词的共现关系，没有考虑对应的语义信息。</p>
</li>
</ul>
<h3 id="22-语言模型">2.2 语言模型</h3>
<p>语言模型，就是判断一段序列是不是一句话。机器学习中，有基于隐马尔科夫等理论的语言模型。</p>
<p>这里跳过，介绍一下深度学习的模型。由2003年的论文中首次提出，使用神经网络训练语言模型(NPLM)。</p>
<p>通过训练语言模型的任务，将训练完成后的embedding层作为对应的词向量。</p>
<p><strong>模型介绍：</strong></p>
<ul>
<li>
<p>任务：给定当前词的上文(n-1个单词)，预测当前词。</p>
</li>
<li>
<p>embedding层：使用one-hot将输入单词编码(1 * V)，与词表(V  * m)映射，将输入单词转换为维度为1*m的向量。n-1个单词拼接为(n-1)*m</p>
</li>
<li>
<p>隐藏层：通过线性变换+tanh激活函数。输出维度为1*h。</p>
</li>
<li>
<p>输出层：通过线性层将隐层输出转成1*V，并通过softmax计算各个单词的概率。取概率最大值对应的单词为模型输出。</p>
</li>
<li>
<p>损失函数：交叉熵</p>
</li>
<li>
<p>词向量：训练完成后，embedding层中V*m的词表即可作为词向量使用。</p>
</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516212722.png" alt="image-20210516212722741" loading="lazy"></figure>
<p><strong>模型局限</strong></p>
<ul>
<li>训练与预测过程以词表的大小成线性关系，计算开销过大，耗时过久。后续word2vec模型基于此模型进行改进。</li>
</ul>
<h2 id="3-常见模型介绍">3 常见模型介绍</h2>
<p>在bert火热之前，词向量的主要方法就是word2vec，也有一部分使用glove的方法。本节主要讲解两个算法的基本思路。</p>
<h3 id="31-word2vec">3.1 word2vec</h3>
<h4 id="311-基本结构">3.1.1 基本结构</h4>
<figure data-type="image" tabindex="3"><img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516213119.png" alt="image-20210516213119511" loading="lazy"></figure>
<p><strong>CBOW</strong></p>
<ul>
<li>
<p>任务：由上下文预测当前词</p>
</li>
<li>
<p>输入：当前词前后各n/2个词</p>
</li>
<li>
<p>输出：softmax后概率最大的词</p>
</li>
</ul>
<p><strong>Skip-Gram</strong></p>
<ul>
<li>
<p>任务：由当前词预测上下文</p>
</li>
<li>
<p>输入：当前单词</p>
</li>
<li>
<p>输出：softmax后概率前n大的单词</p>
</li>
</ul>
<p><strong>问题与改进</strong></p>
<ul>
<li>
<p>局限：每次softmax需要计算V个单词的概率，计算量极大，训练速度慢</p>
</li>
<li>
<p>改进：层次softmax和负采样</p>
</li>
</ul>
<h4 id="312-层次softmax">3.1.2 层次softmax</h4>
<h5 id="3121-哈夫曼树">3.1.2.1 哈夫曼树</h5>
<p><strong>哈夫曼树建立过程</strong></p>
<ul>
<li>
<p>输入：含有权值的n个节点</p>
</li>
<li>
<p>步骤1：将输入看成有n棵树的森林，每棵树仅有一个节点</p>
</li>
<li>
<p>步骤2：在森林中选择权值最小的两棵树进行合并，得到新的树，新树的权重为左右子树根节点权重之和。</p>
</li>
<li>
<p>步骤3：将之前权值最小的两个数从森林删除，并将新的树加入森林。</p>
</li>
<li>
<p>步骤4：重复步骤2,3，直到森林中只有一棵树</p>
</li>
<li>
<p>输出：构建后的哈夫曼树</p>
</li>
</ul>
<p>以下图为例</p>
<figure data-type="image" tabindex="4"><img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516213711.png" alt="image-20210516213711006" loading="lazy"></figure>
<p>最底层的节点为值最小的3和4，两者构建成节点7，同时5和6构建成节点11，以此反复。</p>
<figure data-type="image" tabindex="5"><img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516213803.png" alt="image-20210516213803512" loading="lazy"></figure>
<h5 id="3122-层次softmax介绍">3.1.2.2 层次softmax介绍</h5>
<p><strong>改进</strong></p>
<ul>
<li>
<p>输入层-隐藏层：对于输入层到隐藏层的映射，将原有的线性变换+激活函数修改为输入词向量求平均。</p>
</li>
<li>
<p>隐藏层-softmax层：原神经网络模型中，输出层需要计算全部词的softmax概率。现在使用哈夫曼树的内部节点替换原神经网络的神经元。根节点的词向量对应投影后词向量。叶子节点的类似原神经网络softmax输出层的各个神经元。叶子节点个的个数就是词汇表的大小。每个叶子节点的权重为对应单词的词频。</p>
</li>
</ul>
<figure data-type="image" tabindex="6"><img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516213904.png" alt="image-20210516213904820" loading="lazy"></figure>
<p><strong>优点</strong></p>
<ul>
<li>
<p>计算量由之前的V降低为logV。</p>
</li>
<li>
<p>哈夫曼树的构建是基于词频，高频词更接近树根，更易被找到，符合贪心优化思想。</p>
</li>
</ul>
<h5 id="3123-梯度计算">3.1.2.3 梯度计算</h5>
<p><strong>编码确定</strong></p>
<ul>
<li>
<p>通过二元逻辑回归，规定沿左走为负类，沿右走位正类。以此确定从根节点到叶子节点的哈夫曼编码。</p>
</li>
<li>
<p>正类负类的判断方法是使用sigmoid函数 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo>(</mo><mo>+</mo><mo>)</mo><mo>=</mo><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>o</mi><mi>i</mi><mi>d</mi><mo>(</mo><msubsup><mi>x</mi><mi>w</mi><mi>T</mi></msubsup><mo>)</mo><mo separator="true">,</mo><mi>P</mi><mo>(</mo><mo>−</mo><mo>)</mo><mo>=</mo><mn>1</mn><mo>−</mo><mi>P</mi><mo>(</mo><mo>+</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">P(+)=sigmoid(x_{w}^{T}),P(-)=1-P(+)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord">+</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord">−</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord">+</span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">x_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示当前节点的词向量。θ表示当前节点的模型参数。</p>
</li>
<li>
<p>在内部节点中，下一步是沿左子树还是右子树根据P(+)P(-)概率大小选择对应方向。</p>
</li>
</ul>
<p><strong>似然函数</strong></p>
<ul>
<li>对于目标输出词w，最大似然为<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><munderover><mo>∏</mo><mrow><mi>j</mi><mo>=</mo><mn>2</mn></mrow><msub><mi>l</mi><mi>w</mi></msub></munderover><mi>P</mi><mo>(</mo><msubsup><mi>d</mi><mi>j</mi><mi>w</mi></msubsup><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mi>w</mi></msub><mo separator="true">,</mo><msubsup><mi>θ</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow><mi>w</mi></msubsup><mo>)</mo><mo>=</mo><munderover><mo>∏</mo><mrow><mi>j</mi><mo>=</mo><mn>2</mn></mrow><msub><mi>l</mi><mi>w</mi></msub></munderover><mo>[</mo><mi>σ</mi><mo>(</mo><msubsup><mi>x</mi><mi>w</mi><mi>T</mi></msubsup><msubsup><mi>θ</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow><mi>w</mi></msubsup><mo>)</mo><msup><mo>]</mo><mrow><mn>1</mn><mo>−</mo><msubsup><mi>d</mi><mi>j</mi><mi>w</mi></msubsup></mrow></msup><mo>[</mo><mn>1</mn><mo>−</mo><mi>σ</mi><mo>(</mo><msubsup><mi>x</mi><mi>w</mi><mi>T</mi></msubsup><msubsup><mi>θ</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow><mi>w</mi></msubsup><mo>)</mo><msup><mo>]</mo><msubsup><mi>d</mi><mi>j</mi><mi>w</mi></msubsup></msup></mrow><annotation encoding="application/x-tex">\prod_{j=2}^{l_w}P(d_{j}^{w}|x_{w},\theta_{j-1}^{w})=\prod_{j=2}^{l_w}[\sigma(x_{w}^{T}\theta_{j-1}^{w})]^{1-d_{j}^{w}}[1-\sigma(x_{w}^{T}\theta_{j-1}^{w})]^{d_{j}^{w}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.2609900000000005em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8472130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.311105em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.01968em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714392em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714392em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2609900000000005em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8472130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.311105em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.01968em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714392em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.92998em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7385428571428572em;"><span style="top:-2.214em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.42488571428571426em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.313088em;vertical-align:-0.383108em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714392em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.92998em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7385428571428572em;"><span style="top:-2.214em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.42488571428571426em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>l</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">l_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示从根节点到w所在的叶子节点，包含的节点总数。w在哈夫曼树种，从根节点开始，经过的第j个节点，对应的编码为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>d</mi><mi>j</mi><mi>w</mi></msubsup></mrow><annotation encoding="application/x-tex">d_{j}^{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0892119999999998em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span>,该节点对应的参数为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>θ</mi><mi>j</mi><mi>w</mi></msubsup></mrow><annotation encoding="application/x-tex">\theta_{j}^{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0892119999999998em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.441336em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
<p><strong>梯度表达式</strong></p>
<ul>
<li>基于似然函数，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">x_{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的梯度表达式为：<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>x</mi><mi>w</mi></msub></mrow></mfrac><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>2</mn></mrow><msub><mi>l</mi><mi>w</mi></msub></munderover><mo>(</mo><mn>1</mn><mo>−</mo><msubsup><mi>d</mi><mi>j</mi><mi>w</mi></msubsup><mo>−</mo><mi>σ</mi><mo>(</mo><msubsup><mi>x</mi><mi>w</mi><mi>T</mi></msubsup><msubsup><mi>θ</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow><mi>w</mi></msubsup><mo>)</mo><mo>)</mo><msubsup><mi>θ</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow><mi>w</mi></msubsup></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial x_w} = \sum_{j=2}^{l_w}(1-d_{j}^{w}-\sigma(x_{w}^{T}\theta_{j-1}^{w}))\theta_{j-1}^{w}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.20744em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathdefault">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2609900000000005em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8472130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.311105em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.01968em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0975000000000001em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714392em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.2744389999999999em;vertical-align:-0.383108em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714392em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714392em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span></span></span></span></span></p>
由梯度表达式迭代更新词向量<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">x_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和参数<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>θ</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow><mi>w</mi></msubsup></mrow><annotation encoding="application/x-tex">\theta_{j-1}^{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0892119999999998em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.441336em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
<h4 id="313-负采样">3.1.3 负采样</h4>
<h5 id="3131-降采样">3.1.3.1 降采样</h5>
<p>在训练语料中，有些高频词的出现频率很高，对模型的训练并没有正面的作用。因此使用降采样(subsampling)的方法，先对训练语料进行优化。</p>
<p>对于训练样本，遇到的每一个词，都有可能被丢弃掉。被丢弃的概率与这个词的词频有关。</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo>(</mo><msub><mi>w</mi><mi>i</mi></msub><mo>)</mo><mo>=</mo><mo>(</mo><msqrt><mfrac><mrow><mi>z</mi><mo>(</mo><msub><mi>w</mi><mi>i</mi></msub><mo>)</mo></mrow><mn>0.001</mn></mfrac></msqrt><mo>+</mo><mn>1</mn><mo>)</mo><mo>∗</mo><mfrac><mn>0.001</mn><mrow><mi>z</mi><mo>(</mo><msub><mi>w</mi><mi>i</mi></msub><mo>)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(w_i)=(\sqrt\frac{z(w_i)}{0.001} +1)*\frac{0.001}{z(w_i)}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.44em;vertical-align:-0.7356250000000002em;"></span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7043749999999998em;"><span class="svg-align" style="top:-4.4em;"><span class="pstrut" style="height:4.4em;"></span><span class="mord" style="padding-left:1em;"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span style="top:-3.664375em;"><span class="pstrut" style="height:4.4em;"></span><span class="hide-tail" style="min-width:1.02em;height:2.48em;"><svg width='400em' height='2.48em' viewBox='0 0 400000 2592' preserveAspectRatio='xMinYMin slice'><path d='M424,2478c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,
-342,-109.8,-513.3,-110.5,-514c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,
25c-5.7,9.3,-9.8,16,-12.5,20s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,
-13s76,-122,76,-122s77,-121,77,-121s209,968,209,968c0,-2,84.7,-361.7,254,-1079
c169.3,-717.3,254.7,-1077.7,256,-1081c4,-6.7,10,-10,18,-10H400000v40H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M1001 80H400000v40H1014z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7356250000000002em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.25744em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中，$$z(w_i)$$表示单词的出现频率，频率越高的词，被丢弃的概率越高。频率为1的词，只有3.3%的概率保留。</p>
<h5 id="3132-负采样过程">3.1.3.2 负采样过程</h5>
<ul>
<li>
<p>目的：每次采样时高频词更容易被采样出来，低频词不容易被采样出来。</p>
</li>
<li>
<p>步骤1：将长度为1的线段，根据词表大小，划分成V份，每份的长度与对应词的词频有关。高频词线段长，低频词线段短。len(w)=〖count(w)〗<sup>(3/4)/(∑_(u∈V)▒〖count(u)〗</sup>(3/4) )</p>
<figure data-type="image" tabindex="7"><img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516220125.png" alt="image-20210516220117723" loading="lazy"></figure>
</li>
<li>
<p>步骤2：将长度为1的线段划分成M等份，M≫V，保证M中每一份均可以对应步骤1中划分的线段。</p>
<figure data-type="image" tabindex="8"><img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516220156.png" alt="image-20210516220144092" loading="lazy"></figure>
</li>
<li>
<p>步骤3：在0~M中随机生成数字，数字对应的词就是对应采样的结果。M常见设定值10^8</p>
</li>
</ul>
<h5 id="3133-负采样分析">3.1.3.3 负采样分析</h5>
<p><strong>改进</strong></p>
<ul>
<li>
<p>层次softmax缺点：对于生僻词，到达叶子结点的所需的深度很深。效率相对较低。</p>
</li>
<li>
<p>负采样思路：对于一个训练样本，中心词是w，上下文为context(w)。中心词与上下文构成真实的<strong>正例</strong>。通过负采样，采集到neg个与w不同的词w_i**,<strong>i=1,2,..neg。context(w)与w_i 组成了neg个</strong>负例**。通过1个真实的正例和负采样得到的neg个负例，计算更新中心词和采样得到的neg个词对应的模型参数和词向量。</p>
</li>
</ul>
<p><strong>优点</strong></p>
<ul>
<li>相较原始神经网络模型，最后一层的参数计算量从 hidden_size * |V| 减少到 hidden_size * (1+neg)。 计算量相较之前有了很大的降低。</li>
<li>通过负采样算法，虽然模型的参数维度没有发生变化，但是在更新过程中的计算量进行了减少。</li>
</ul>
<h5 id="3134-梯度计算">3.1.3.4 梯度计算</h5>
<p><strong>正例负例定义</strong></p>
<ul>
<li>
<p>负采样通过二元逻辑回归求解模型参数。$$w_0$$,$$w_i,i=1,2,...neg$$分表表示正例和负例</p>
</li>
<li>
<p>对于正例</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo>(</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>x</mi><mo>(</mo><msub><mi>w</mi><mn>0</mn></msub><mo>)</mo><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo>)</mo><mo>=</mo><mi>σ</mi><mo>(</mo><msubsup><mi>x</mi><msub><mi>w</mi><mn>0</mn></msub><mi>T</mi></msubsup><msup><mi>θ</mi><msub><mi>w</mi><mi>i</mi></msub></msup><mo>)</mo><mo separator="true">,</mo><mi>i</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">P(contex(w_0),w_i)=\sigma(x_{w_0}^{T}\theta^{w_i}),i=0
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2384309999999998em;vertical-align:-0.34709999999999996em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.891331em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></span></p>
</li>
<li>
<p>对于负例</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mo>(</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>x</mi><mo>(</mo><msub><mi>w</mi><mn>0</mn></msub><mo>)</mo><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo>)</mo><mo>=</mo><mn>1</mn><mo>−</mo><mi>σ</mi><mo>(</mo><msubsup><mi>x</mi><msub><mi>w</mi><mn>0</mn></msub><mi>T</mi></msubsup><msup><mi>θ</mi><msub><mi>w</mi><mi>i</mi></msub></msup><mo>)</mo><mo separator="true">,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>n</mi><mi>e</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">P(contex(w_0),w_i)=1-\sigma(x_{w_0}^{T}\theta^{w_i}),i=1,2,...,neg
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.2384309999999998em;vertical-align:-0.34709999999999996em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.891331em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span></span></p>
</li>
<li>
<p>期望最大化</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow></mrow><annotation encoding="application/x-tex"></annotation></semantics></math></span><span class="katex-html" aria-hidden="true"></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow></mrow><annotation encoding="application/x-tex">
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"></span></span></span></p>
</li>
</ul>
<p class='katex-block katex-error' title='ParseError: KaTeX parse error: Unknown column alignment: * at position 128: … \begin{array}{*̲*lr**}  1,i=0, …'>\prod_{i=1}^{neg}\sigma(x_{w_0}^{T}\theta^{w_i})^{y_i}(1-\sigma(x_{w_0}^{T}\theta^{w_i}))^{1-y_i}, y_i =\left\{  \begin{array}{**lr**}  1,i=0, &amp;  \\  0,i=1,2,..,neg &amp;\end{array}  \right.
</p>
<p>梯度表达式</p>
<ul>
<li>基于似然函数,$$x_{w_0}$$的梯度表达式为<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow></mrow><annotation encoding="application/x-tex"></annotation></semantics></math></span><span class="katex-html" aria-hidden="true"></span></span></span></p>
<p class='katex-block katex-error' title='ParseError: KaTeX parse error: Can&#039;t use function &#039;$&#039; in math mode at position 14: 由梯度表达式迭代更新词向量$̲x_{w_0}$和参数$\th…'>由梯度表达式迭代更新词向量$x_{w_0}$和参数$\theta^{w_i}$

</p>
</li>
</ul>
<p>Glove: Global Vectors for Word Representation。是一种基于全局词频统计的词表征工具。</p>
<h4 id="321-构建步骤">3.2.1 构建步骤</h4>
<ul>
<li>
<p>构建共现矩阵X。矩阵中的元素X_ij表示单词i和单词j在窗口中共同出现的次数。同时根据两个单词的距离，使用1/d作为衰减函数计算权重。距离越远的两个单词，计数权重越小。</p>
</li>
<li>
<p>构建词向量与共现矩阵的近似关系。论文作者提出一个近似表达两者关系的公式, w为对应词向量，b为偏差</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>w</mi><mi>i</mi><mi>T</mi></msubsup><mover accent="true"><msub><mi>w</mi><mi>j</mi></msub><mo>~</mo></mover><mo>+</mo><msub><mi>b</mi><mi>i</mi></msub><mo>+</mo><mover accent="true"><msub><mi>b</mi><mi>j</mi></msub><mo>~</mo></mover><mo>=</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo>(</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">w_{i}^{T}\tilde{w_{j}}+b_i +\tilde{b_j}=log(x_{ij})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.177439em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.2174079999999998em;vertical-align:-0.286108em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9312999999999998em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61344em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
</li>
<li></li>
<li>
<p>构建损失函数。基于MSE损失函数，添加权重函数$$f(x_{ij})$$。权重函数具有三个功能，</p>
<ul>
<li>1)经常一起出现的单词，具有较大的权重。</li>
<li>2)权重不会随出现次数无限增加。</li>
<li>3)两个单词没有一起出现过，则权重为0</li>
</ul>
<p>函数图像如图所示</p>
<figure data-type="image" tabindex="9"><img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516222849.png" alt="image-20210516222849717" loading="lazy"></figure>
</li>
<li>
<p>损失函数如下</p>
<p class='katex-block katex-error' title='ParseError: KaTeX parse error: Unknown column alignment: * at position 126: … \begin{array}{*̲*lr**}  
      …'>J=\sum_{i,j=1}^{V}f(x_{ij})(w_{i}^{T}\tilde{w_{j}}+b_i +\tilde{b_j}-log(x_{ij})^2, f(x)=\left\{  
             \begin{array}{**lr**}  
            (\frac{x}{x_{max}})^2, &amp;  \\  
             1 &amp;     
             \end{array}  
\right.
</p>
</li>
</ul>
<h4 id="322-优缺点">3.2.2 优缺点</h4>
<ul>
<li>
<p>优点：相较word2vec只关注局部信息，glove构建过程中参考了全局信息。在论文中理论效果优于word2vec。</p>
</li>
<li>
<p>缺点1: 因为使用了全局信息，在计算过程中内存占用过高。</p>
</li>
<li>
<p>缺点2: 因为偏差的存在，如果偏差过大，会导致各词向量比较接近，区分度低。</p>
</li>
<li>
<p>缺点3: 在实际使用中，停用词对应的向量模长通常较大，对于文本分类等任务影响较大。</p>
</li>
</ul>
<h2 id="4-后续发展">4 后续发展</h2>
<p>前面章节介绍的词向量方法，虽然相较之前有了提升，但是对于多义词的区分，已经更深更准确的词向量挖掘还存在不足。</p>
<h3 id="41-emlo">4.1 EMLO</h3>
<img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516224106.png" alt="image-20210516224106385" style="zoom:50%;" />
<p><strong>基本信息</strong></p>
<ul>
<li>
<p>基本结构：双层双向的LSTM网络结构，动态输出词向量</p>
</li>
<li>
<p>优点：针对静态词向量，可以解决多义词问题</p>
</li>
<li>
<p>缺点：特征抽取器没有使用热门的transformer</p>
</li>
</ul>
<h3 id="42-gpt">4.2 GPT</h3>
<img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516224141.png" alt="image-20210516224141099" style="zoom:50%;" />
<p><strong>基本信息</strong></p>
<ul>
<li>
<p>基本结构：单向的transformer网络结构</p>
</li>
<li>
<p>优点：在NLP任务中效果显著，12个任务中9个达到最佳效果</p>
</li>
<li>
<p>缺点：模型为单向模型，没有结合下文信息</p>
</li>
<li>
<p>更新：2020年5月发布GPT-3,参数量高达1750亿，单次训练成本1200万美元</p>
</li>
</ul>
<h3 id="43-bert">4.3 Bert</h3>
<img src="https://raw.githubusercontent.com/MaXXXXfeng/typora-res/main/data/20210516224216.png" alt="image-20210516224216863" style="zoom:50%;" />
<p><strong>基本信息</strong></p>
<ul>
<li>
<p>基本结构：双向的transformer网络结构</p>
</li>
<li>
<p>优点：实际效果优秀，在11个NLP任务中达到最优效果</p>
</li>
<li>
<p>缺点：基于训练任务，更适合自然语言理解类任务(NLU)，不适合自语言生成类任务(NLG)</p>
</li>
</ul>
<h2 id="5-参考文献">5 参考文献</h2>
<ul>
<li>NPLM: A Neural Probabilistic Language Model, 2003</li>
<li>Word2vec: Efficient Estimation of Word Representation, 2013</li>
<li>Distributed Representations of Words and Phrases and their Compositionality, 2013</li>
<li>Glove: Glove: Global Vectors for Word Representation, 2014</li>
<li>ELMo: Deep contextualized word representations, 2018</li>
<li>GPT-1: Improving Language Understanding by Generative Pre-training, 2018</li>
<li>GPT-2: Language Models are unsupervised multitask learners, 2019</li>
<li>GPT-3: Langugae Models are few shot learners, 2020</li>
<li>Bert:BERT: Pre-trainin of Deep Bidirectional Transformers for Language Understanding, 2018</li>
</ul>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-word-embedding%E4%BB%8B%E7%BB%8D">1 word embedding介绍</a></li>
<li><a href="#2-%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2">2 发展历史</a>
<ul>
<li><a href="#21-%E7%BB%9F%E8%AE%A1%E6%A8%A1%E5%9E%8Bone-hot-%E7%BC%96%E7%A0%81">2.1 统计模型：One-Hot 编码</a></li>
<li><a href="#22-%E7%BB%9F%E8%AE%A1%E6%A8%A1%E5%9E%8B%E5%85%B1%E7%8E%B0%E5%90%91%E9%87%8F">2.2 统计模型：共现向量</a></li>
<li><a href="#22-%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B">2.2 语言模型</a></li>
</ul>
</li>
<li><a href="#3-%E5%B8%B8%E8%A7%81%E6%A8%A1%E5%9E%8B%E4%BB%8B%E7%BB%8D">3 常见模型介绍</a>
<ul>
<li><a href="#31-word2vec">3.1 word2vec</a>
<ul>
<li><a href="#311-%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84">3.1.1 基本结构</a></li>
<li><a href="#312-%E5%B1%82%E6%AC%A1softmax">3.1.2 层次softmax</a>
<ul>
<li><a href="#3121-%E5%93%88%E5%A4%AB%E6%9B%BC%E6%A0%91">3.1.2.1 哈夫曼树</a></li>
<li><a href="#3122-%E5%B1%82%E6%AC%A1softmax%E4%BB%8B%E7%BB%8D">3.1.2.2 层次softmax介绍</a></li>
<li><a href="#3123-%E6%A2%AF%E5%BA%A6%E8%AE%A1%E7%AE%97">3.1.2.3 梯度计算</a></li>
</ul>
</li>
<li><a href="#313-%E8%B4%9F%E9%87%87%E6%A0%B7">3.1.3 负采样</a>
<ul>
<li><a href="#3131-%E9%99%8D%E9%87%87%E6%A0%B7">3.1.3.1 降采样</a></li>
<li><a href="#3132-%E8%B4%9F%E9%87%87%E6%A0%B7%E8%BF%87%E7%A8%8B">3.1.3.2 负采样过程</a></li>
<li><a href="#3133-%E8%B4%9F%E9%87%87%E6%A0%B7%E5%88%86%E6%9E%90">3.1.3.3 负采样分析</a></li>
<li><a href="#3134-%E6%A2%AF%E5%BA%A6%E8%AE%A1%E7%AE%97">3.1.3.4 梯度计算</a></li>
</ul>
</li>
<li><a href="#321-%E6%9E%84%E5%BB%BA%E6%AD%A5%E9%AA%A4">3.2.1 构建步骤</a></li>
<li><a href="#322-%E4%BC%98%E7%BC%BA%E7%82%B9">3.2.2 优缺点</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-%E5%90%8E%E7%BB%AD%E5%8F%91%E5%B1%95">4 后续发展</a>
<ul>
<li><a href="#41-emlo">4.1 EMLO</a></li>
<li><a href="#42-gpt">4.2 GPT</a></li>
<li><a href="#43-bert">4.3 Bert</a></li>
</ul>
</li>
<li><a href="#5-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">5 参考文献</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://MaXXXXfeng.github.io/post/flask-project-tree/">
              <h3 class="post-title">
                Flask基本项目结构
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: 'd4340f15bb5174d34269',
    clientSecret: 'a8044523d5c79dc56062fcdaae7bbc97731a09ad',
    repo: 'MaXXXXfeng.github.io',
    owner: 'MaXXXXfeng',
    admin: ['MaXXXXfeng'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://MaXXXXfeng.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()

  let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

  // This should probably be throttled.
  // Especially because it triggers during smooth scrolling.
  // https://lodash.com/docs/4.17.10#throttle
  // You could do like...
  // window.addEventListener("scroll", () => {
  //    _.throttle(doThatStuff, 100);
  // });
  // Only not doing it here to keep this Pen dependency-free.

  window.addEventListener("scroll", event => {
    let fromTop = window.scrollY;

    mainNavLinks.forEach((link, index) => {
      let section = document.getElementById(decodeURI(link.hash).substring(1));
      let nextSection = null
      if (mainNavLinks[index + 1]) {
        nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
      }
      console.log('section.offsetHeight', section.offsetHeight);
      if (section.offsetTop <= fromTop) {
        if (nextSection) {
          if (nextSection.offsetTop > fromTop) {
            link.classList.add("current");
          } else {
            link.classList.remove("current");    
          }
        } else {
          link.classList.add("current");
        }
      } else {
        link.classList.remove("current");
      }
    });
  });

</script>

      </div>
    </div>
  </body>
</html>
